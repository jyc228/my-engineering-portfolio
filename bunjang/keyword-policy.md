# í‚¤ì›Œë“œ ì •ì±… ì„œë¹„ìŠ¤ ê³ ë„í™”

## ë°°ê²½ ë° ë„ì „

í‚¤ì›Œë“œ ì •ì±… ì„œë¹„ìŠ¤ëŠ” íšŒì‚¬ ë°±ì—”ë“œ ì£¼ìš” ì„œë¹„ìŠ¤ë“¤ì´ ì‚¬ìš©í•˜ëŠ” ê¸ˆì§€ì–´ íƒì§€ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
*ìƒí’ˆ ë“±ë¡*, *ê²€ìƒ‰*, *ì±„íŒ…*, *ì´ë¯¸ì§€ í…ìŠ¤íŠ¸* ë“± ìœ ì €ê°€ ìƒì„±í•  ìˆ˜ ìˆëŠ” ëŒ€ë¶€ë¶„ì˜ í…ìŠ¤íŠ¸ ì…ë ¥ì„ ê²€ì¦í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì´ í”„ë¡œì íŠ¸ë¥¼ ì¸ìˆ˜ì¸ê³„ ë°›ì•„ ìœ ì§€ë³´ìˆ˜ ì¤‘ì— í—ˆìš©ì–´ê°€ ì˜ ì•ˆëœë‹¤ë¼ëŠ” ë¬¸ì œë¥¼ ì œë³´ë°›ì•„ ë²„ê·¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ê³¼ì •ì—ì„œ ê¸°ì¡´ ì½”ë“œëŠ” ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µë‹¤ ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
ë˜í•œ ì•ˆì „ê²°ì œ 100% ë„ì… ë° ìˆ˜ìˆ˜ë£Œ ì¸ìƒìœ¼ë¡œ ì¸í•˜ì—¬ ê°ì¢… ê¸ˆì§€ì–´ ìš°íšŒíŒ¨í„´ì´ ë“±ì¥í•˜ê³  ìˆì—ˆê³ , ê¸°ì¡´ ì‹œìŠ¤í…œìœ¼ë¡œëŠ” ì´ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ëŒ€ì‘í•˜ì§€ ëª»í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
ì´ ë‘ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ ê¸°ì¡´ ì‹œìŠ¤í…œì„ ë¦¬íŒ©í† ë§í•˜ê³ , ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì„œ ëŒ€ì‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## í”„ë¡œì íŠ¸ ê°œìš”

- ê¸°ê°„: 2025.12 - 2026.02 (ì•½ 2ê°œì›”)
- ì¸ì›: 1ëª…

## ì£¼ìš” í•´ê²° ê³¼ì œ

### client library

- ê¸°ì¡´ì˜ ë³µì¡í–ˆë˜ í—ˆìš©ì–´ ê¸°ëŠ¥ì„ ë‹¨ìˆœí™”
- íŠ¹ì • ê¸°ìˆ ì— ì¹¨íˆ¬ì ì¸ ì½”ë“œë¥¼ ì£¼ìš” ë¡œì§ê³¼ ë¶„ë¦¬(spring, rsocket)
- api ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ì„¤ì •ì„ ë™ì ìœ¼ë¡œ ê°±ì‹ í•  ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ ë£¨í”„ ë„ì…
- ë§ˆìŠ¤í‚¹, ê¸ˆì§€ì–´ ê²€ì¦ì„ ê°ê° í´ë˜ìŠ¤ì—ì„œ ì²˜ë¦¬í•˜ë˜ê±¸ ëª©ì ì— ë§ê²Œ ë¶„ë¦¬í•˜ê³  ì„±ëŠ¥ ìµœì í™”
- ë‹¤ì•™í–” ëª©ì ì— ë§ê²Œ api ì„œë²„ì— ë¡œê¹…ì„ ë³´ë‚¼ìˆ˜ ìˆë„ë¡ ê°œì„ 
- ê°ì¢… ë³€ì¢…ì„ ëŒ€ì‘í•˜ê¸° ìœ„í•œ í…ìŠ¤íŠ¸ ì •ê·œí™” ë‹¨ê³„ ì¶”ê°€

### api server

- client ì˜ ì„¤ì •ì„ ì›ê²©ìœ¼ë¡œ ì¡°ì ˆí•  ìˆ˜ ìˆë„ë¡ ê°œì„ 
- client ê°€ ì „ì†¡í•˜ëŠ” ë¡œê·¸ë¥¼ ë°›ì•„ ê°ì¢… ê´€ì¸¡ ë„êµ¬ì— ë³´ì—¬ì£¼ë„ë¡ ê°œì„ 

## ì•„í‚¤í…ì³

ì•„ë˜ í”Œë¡œìš° ì°¨íŠ¸ê°€ ë³´ì´ì§€ ì•Šìœ¼ì‹œë‹¤ë©´ ê¹ƒí—ˆë¸Œì—ì„œ ë´ì£¼ì„¸ìš”.
[link](https://github.com/jyc228/my-engineering-portfolio/blob/main/bunjang/keyword-policy.md#%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90)

```mermaid
flowchart
    ê°ì¢…_ì„œë¹„ìŠ¤ -- ê¸ˆì§€ì–´ íƒì§€, ê¸ˆì§€ì–´ ë§ˆìŠ¤í‚¹ --> ì •ì±…_êµ¬ë¬¸_ê·¸ë£¹ -- ë¡œê¹… --> keyword_policy_server
    keyword_policy_server -- êµ¬ë¬¸ ê°±ì‹ , proxy ì„¤ì • ê°±ì‹  --> ì´ë²¤íŠ¸ë£¨í”„
    subgraph keyword_policy_client
        ì´ë²¤íŠ¸ë£¨í”„ -- ê°±ì‹  --> ì •ì±…_êµ¬ë¬¸_ê·¸ë£¹
    end
```

## ì£¼ìš” ê¸°ì—¬

### client ë§ˆìŠ¤í‚¹, ê¸ˆì§€ì–´ ê²€ì¦ ê¸°ëŠ¥ ì¬êµ¬í˜„ ë° ì„±ëŠ¥ ìµœì í™”

ê¸°ì¡´ ì½”ë“œëŠ” ë§ˆìŠ¤í‚¹, ê¸ˆì§€ì–´ ê²€ì¦ì´ë¼ëŠ” ê¸°ëŠ¥ì„ í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ í‘œí˜„í•˜ì˜€ê³ , ìˆ˜ì •í•œ ë¬¸ìì—´ì„ ë‹¨ì¼ í´ë˜ìŠ¤ì— ë“¤ê³  ìˆëŠ” í˜•íƒœì˜€ìŠµë‹ˆë‹¤.

í•˜ë‹¨ì€ ê¸ˆì§€ì–´ ê²€ì¦ì¸¡ ì½”ë“œë¥¼ ë‹¨ìˆœí™” í•˜ì˜€ìŠµë‹ˆë‹¤.

```kotlin
class KeywordPreset(val lowercase: String, val uppercase: String /* ê·¸ ì™¸ í•„ë“œ 4ê°œ */)
class VerifyProcessor(val allows: List<Phrase>, val blocks: List<Phrase>) {
    fun hasBlocked(preset: KeywordPreset): Boolean {
        for (phrase in allows) {
            preset.lowercase.replace(phrase.pattern, "") // 6 í•„ë“œ ëª¨ë‘ ìˆ˜í–‰ 
        }

        for (phrase in blocks) {
            // preset ì—ì„œ ì í•©í•œ í•„ë“œ í•˜ë‚˜ ì„ íƒí•´ì„œ exact, contain, regex ë§¤ì¹­ ì¤‘ í•˜ë‚˜ ì‹¤í–‰
            if (phrase.matchs(preset)) return true
        }
        return false
    }
}
```

ì´ë¥¼ êµ¬ë¬¸ ì„±ê²©ì— ë”°ë¼ ë§¤ì¹­ í´ë˜ìŠ¤ë¥¼ ë‚˜ëˆ„ê³  í†µí•© í”„ë¡œì„¸ì„œë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```kotlin
// ë‹¨ìˆœíˆ êµ¬ë¬¸ì„ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë§¤ì¹­í•œë‹¤. ë¼ëŠ”ê²ƒì„ í‘œí˜„í•©ë‹ˆë‹¤.
internal sealed interface PhraseMatcher {
    fun fillMatchIndex(text: CharSequence, matchedIndices: MutableMap<Int, Set<Int>>)
    fun firstMatch(text: String): PhraseMatchResult?
    fun containMatch(text: String): Boolean

    companion object {
        // hashcodeë¥¼ í™œìš©í•˜ì—¬ O(1) ì—°ì‚°ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. if (text in idByPattern)
        fun exact(idByPattern: Map<String, Int>): PhraseMatcher = ExactPhraseMatcher(idByPattern)

        // ì•„í˜¸ì½”ë¼ì‹ì„ í™œìš©í•˜ì—¬ O(n) ì—°ì‚°ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. n = text ê¸¸ì´
        fun contain(patternById: Map<Int, String>): PhraseMatcher = ContainPhraseMatcher(patternById)

        // ì •ê·œì‹ for
        fun regex(patternById: Map<Int, String>): PhraseMatcher = RegexPhraseMatcher(patternById)
    }
}

class PhrasePipeline {
    fun findBlockKeyword(text: String): PhraseMatchResult? {
        val refinedText = allow.process(text)
        for ((text, type, lang) in DerivedStringSequence(refinedText)) {
            val blockedText = block.process(allowedText, type, lang)
            if (blockedText != null) return blockedText
        }
        return null
    }
}
```

ìƒˆë¡­ê²Œ êµ¬í˜„ëœ ì½”ë“œë“¤ì€ phrase ê°€ ë§ê³ , text input ì´ ê¸¸ë©´ ê¸¸ìˆ˜ë¡ ê¸°ì¡´ ëŒ€ë¹„ exact, contain ì—ì„œ ì„±ëŠ¥ ì°¨ì´ë¥¼ ë³´ì—¬ì¤¬ìŠµë‹ˆë‹¤.
ë˜í•œ í…ŒìŠ¤íŠ¸ ìš©ì´ì„±, ìœ ì§€ë³´ìˆ˜ì„± ì¦ëŒ€ ë“± ë‹¤ì–‘í•œ ê°œì„ ì‚¬í•­ë„ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.

#### ë²¤ì¹˜ë§ˆí¬

- ë§¥ë¶ m4
- exact êµ¬ë¬¸ 20ê°œ, contain êµ¬ë¬¸ 50ê°œ ì‹œë®¬ë ˆì´ì…˜

```
exactV1    thrpt    3  37889472.663 Â± 9552229.574  ops/s
exactV2    thrpt    3  95220132.204 Â± 3665947.321  ops/s
containV1  thrpt    3   796130.736  Â±  84858.020   ops/s
containV2  thrpt    3  3036908.411  Â± 147106.356   ops/s
```

### ì´ë²¤íŠ¸ ê¸°ë°˜ ë™ì  ì„¤ì • ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

client ì¸¡ì—ì„œ ì„œë²„ í‘¸ì‰¬ë¥¼ ë°›ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ êµ¬ì¶•í•˜ì—¬ ì„œë²„ ì£¼ë„ì˜ ì‹¤ì‹œê°„ ì •ì±… ì „íŒŒ ë° ì œì–´ ì•„í‚¤í…ì²˜ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```kotlin
private val job = scope.launch {
    initJob.join() // ì´ˆê¸°í™” ëŒ€ê¸°

    val channel = Channel<SignalResponse>(Channel.BUFFERED)
    launch {
        // ì„œë²„ í‘¸ì‰¬ ë©”ì‹œì§€ êµ¬ë… ì‹œì‘
        val request = SignalSubscriptionRequest(types, applicationName, VERSION)
        internalClient.signalFlow(request).collect { channel.send(it) }
    }

    launch {
        while (isActive) {
            // ìµœì†Œ refreshInterval ë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ì˜ ì •ì±…ì„ í™•ì¸ ë° ê°±ì‹ í•©ë‹ˆë‹¤.
            val signal = withTimeoutOrNull(refreshInterval) { channel.receive() }
            val handler = handlerResolver.resolve(signal) ?: continue
            for (proxy in groupByType.values) handler(proxy)
        }
    }.invokeOnCompletion { channel.close() }
}
```

ì´ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ êµ¬í˜„ / êµ¬í˜„í•  ì˜ˆì • ì…ë‹ˆë‹¤.

- ìƒˆë¡­ê²Œ êµ¬í˜„í•œ ê¸ˆì§€ì–´ ê²€ì¦ ì½”ë“œë¥¼ ë³‘ë ¬ ì‹¤í–‰ ë° ê¸°ì¡´ ì½”ë“œì™€ ë¶ˆì¼ì¹˜ í•˜ëŠ” ê²½ìš° ì„œë²„ë¡œ ë³´ê³ í•˜ëŠ” ê¸°ëŠ¥ (ì„œë²„ ì œì–´ë¡œ ë³‘ë ¬ ì‹¤í–‰ ë¹„ìœ¨ ì¡°ì ˆ ê°€ëŠ¥)
- ì‚¬ìš© ë¹ˆë„ê°€ ë§¤ìš° ë‚®ì€ íŠ¹ìˆ˜ë¬¸ìì—´ íƒì§€ ë° ì„œë²„ ë³´ê³ 
- í‰ìƒì‹œë³´ë‹¤ ê¸ˆì§€ì–´ íƒì§€ê°€ ë§ì´ ë  ê²½ìš°, ì„œë²„ë¡œ ë³´ê³ 
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### í…ìŠ¤íŠ¸ ì •ê·œí™” ë‹¨ê³„ ê°œë°œ

ì•ˆì „ê²°ì œ ìˆ˜ìˆ˜ë£Œ ì¸ìƒ ì´í›„ ë‹¤ìŒê³¼ ê°™ì€ ìš°íšŒ íŒ¨í„´ë“¤ì´ ìš°í›„ì£½ìˆœ ë°œìƒí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

- ğŸ¦€ì¢Œ : ê³„ì¢Œ
- ã„±ã…’ì¢Œ : ê³„ì¢Œ
- ğŸ«ğŸ’¬ : ì¹´ì¹´ì˜¤í†¡

í—ˆìš© -> ê¸ˆì§€ë¡œ ì´ë¤„ì§„ í˜„ì¬ ìƒíƒœì—ì„  ìœ„ì™€ ê°™ì€ íŒ¨í„´ë“¤ì„ ì œì–´í•˜ê¸° ìœ„í•´ì„  ê° ë³€ì¢…ë§ˆë‹¤ ê¸ˆì§€ì–´ ê·œì¹™ì„ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
ì´ëŠ” ìš´ì˜ ê³µìˆ˜ê°€ ë§¤ìš° ë§ì´ ë“¤ê³ , ë§ì€ ê¸ˆì§€ì–´ ë“±ë¡ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ í…ìŠ¤íŠ¸ ì •ê·œí™” ë‹¨ê³„ë¥¼ ì¶”ê°€í•˜ì—¬ `í—ˆìš© -> ì •ê·œí™” -> ê¸ˆì§€` 3ë‹¨ê³„ íŒŒì´í”„ë¼ì´ë‹ìœ¼ë¡œ í•´ê²°í•˜ë ¤ê³  í•˜ê³  ìˆìŠµë‹ˆë‹¤.
í•µì‹¬ì€ mapping í…Œì´ë¸”ì„ ì¶”ê°€í•˜ê³ , í•œêµ­ì–´ëŠ” ìœ ë‹ˆì½”ë“œ ì¡°í•©ì„ í†µí•´ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ë¡œ ì¹˜í™˜ë§Œ í•˜ëŠ”ê²ƒì…ë‹ˆë‹¤.

- ğŸ¦€ -> ê³„
- ğŸ« -> ì¹´
- ğŸ’¬ -> í†¡
- ã„±ã…’ -> ê±”

ì´ ê¸°ëŠ¥ê³¼ í•¨ê»˜, *ì‚¬ìš© ë¹ˆë„ê°€ ë‚®ì€ ë¬¸ìì—´ íƒì§€ ë° ë³´ê³  ê¸°ëŠ¥*ì´ í•©ì³ì§„ë‹¤ë©´, ìì²´ì ìœ¼ë¡œ í”¼ë“œë°± ê°€ëŠ¥í•œ ê¸ˆì§€ì–´ íƒì§€ ì‹œìŠ¤í…œì´ ì™„ì„±ë˜ë¦¬ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.